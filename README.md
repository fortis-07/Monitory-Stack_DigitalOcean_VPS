
#  Monitory-Stack Deployment for DigitalOcean VPS  
**End-to-End Automation with Terraform + Ansible | Observability Stack**  

A fully automated deployment where:  
- **Terraform** provisions the VPS **and triggers Ansible via provisioners**  
- **Ansible** configures Prometheus, Grafana, Loki, Alertmanager, and StatsD Exporter  

---

## üìã Table of Contents  
- [Repository Structure](#-repository-structure)  
- [Features](#-features)  
- [Architecture](#-architecture)  
- [Technologies Used](#-technologies-used)  
- [Prerequisites](#-prerequisites)  
- [Automated Deployment](#-automated-deployment)  
- [Accessing Services](#-accessing-services)  
- [Troubleshooting](#-troubleshooting)  
- [Contributing](#-contributing)  
- [License](#-license)  

---

## üìÇ Repository Structure  
```plaintext
Monitory-Stack_DigitalOcean_VPS/
‚îú‚îÄ‚îÄ ansible/                   # Ansible configuration
‚îÇ   ‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prometheus/        # Prometheus installation/config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grafana/           # Grafana setup
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loki/              # Loki log aggregation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ alertmanager/      # Alertmanager configuration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ statsd_exporter/   # StatsD Exporter setup
‚îÇ   ‚îú‚îÄ‚îÄ inventory.ini          # Auto-generated by Terraform
‚îÇ   ‚îî‚îÄ‚îÄ site.yml               # Main playbook (triggered by Terraform)
‚îÇ
‚îú‚îÄ‚îÄ terraform/                 # Infrastructure as Code
‚îÇ   ‚îú‚îÄ‚îÄ main.tf                # DigitalOcean provider + VPS definition
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf             # Outputs VPS IP
‚îÇ   ‚îú‚îÄ‚îÄ terraform.tfvars       # API token + SSH key (gitignored)
‚îÇ   ‚îî‚îÄ‚îÄ variables.tf           # Variable declarations
‚îÇ
‚îú‚îÄ‚îÄ monitoring-configs/        # Service configurations
‚îÇ   ‚îú‚îÄ‚îÄ prometheus/            # Prometheus alert rules + scrape configs
‚îÇ   ‚îú‚îÄ‚îÄ loki/                  # Loki config files
‚îÇ   ‚îî‚îÄ‚îÄ alertmanager/          # Alertmanager routing rules
‚îÇ
‚îî‚îÄ‚îÄ README.md                  # This documentation
```

---

## üöÄ Features  
- **Hands-Off Deployment:**  
  - Terraform‚Äôs `local-exec` provisioner **auto-triggers Ansible** ‚Äì no manual steps.

- **Full Observability Stack:**  
This monitoring stack provides end-to-end observability with metrics, logs, and alerts:
- **Metrics Collection:** Prometheus scrapes metrics from targets, StatsD Exporter converts StatsD format metrics
- **Log Management:** Loki collects and indexes logs
- **Visualization:** Grafana provides dashboards for metrics and logs
- **Alerting:** Alertmanager handles alert notification and routing.
- **Secure Defaults:**  
  - UFW firewall restricts access to essential ports (`3000`, `9090`, etc.).  

---

## üèóÔ∏è Architecture  
```mermaid  
graph TB
  subgraph Your Local Machine
    A[Terraform] -->|1. Provisions VPS| B[DigitalOcean Droplet]
    A -->|2. Triggers| C[Ansible]
  end

  subgraph DigitalOcean VPS
    C -->|3. Configures| D[Prometheus]
    C -->|3. Configures| E[StatsD Exporter]
    C -->|3. Configures| F[Grafana]
    C -->|3. Configures| G[Loki]
    C -->|3. Configures| H[Alertmanager]

    D -->|Scrapes Metrics| E
    D -->|Sends Alerts| H
    F -->|Visualizes| D & G
  end

  style A fill:#5C4EE5,stroke:#333
  style C fill:#E95420,stroke:#333
  style D fill:#E6522C,stroke:#333
  style E fill:#3DD6F5,stroke:#333 
```  

---

## üõ†Ô∏è Technologies Used  
| Component         | Technology      |  
|-------------------|-----------------|  
| **Infrastructure**| Terraform       |  
| **Configuration** | Ansible         |  
| **Monitoring**    | Prometheus      |  
| **Logging**       | Loki            |  
| **Alerting**      | Alertmanager    |  
| **Metrics**       | StatsD Exporter |  

---

## ‚öôÔ∏è Automated Deployment  
### 1. Clone and Configure  
```bash  
git clone https://github.com/fortis-07/Monitory-Stack_DigitalOcean_VPS.git  
cd Monitory-Stack_DigitalOcean_VPS/terraform  
echo 'do_token = "YOUR_DIGITALOCEAN_API_TOKEN"' > terraform.tfvars  
echo 'ssh_key_name = "YOUR_SSH_KEY_NAME"' >> terraform.tfvars  
```  

### 2. Deploy  
```bash  
terraform init  
terraform apply -auto-approve  # Provisions VPS + triggers Ansible  
```  

**What Happens Automatically:**  
1. Terraform creates the VPS and runs:  
   ```hcl  
   provisioner "local-exec" {  
     command = "ansible-playbook -i '${self.ipv4_address},' ../ansible/site.yml --user=root"  
   }  
   ```  
2. Ansible installs/configures all services (see [Repository Structure](#-repository-structure)).  

---

## üåê Accessing Services  
| Service          | URL                                  |  
|------------------|--------------------------------------|  
| **Grafana**      | `http://<vps-ip>:3000`              |  
| **Prometheus**   | `http://<vps-ip>:9090`              |  
| **Loki**         | `http://<vps-ip>:9080`              |  
| **Alertmanager** | `http://<vps-ip>:9093`              |  

**Grafana Setup:**  
1. Add data sources:  
   - Prometheus: `http://localhost:9090`  
   - Loki: `http://localhost:9080`  

---

## üîß Troubleshooting  
### **Terraform Errors**  
- **"Failed to trigger Ansible"**:  
  - Verify `ansible-playbook` is in your local `$PATH`.  
  - Check paths in `local-exec` (relative to `terraform/`).  

### **Service Issues**  
```bash  
ssh root@<vps-ip>  
journalctl -u prometheus -u statsd-exporter --no-pager  # Check logs  
```  

---

## ü§ù Contributing  
1. Fork the repo.  
2. Create a branch (`git checkout -b feature/your-feature`).  
3. Submit a PR.  

---

## üìú License  
MIT ¬© [fortis-07](https://github.com/fortis-07)  
```

---

### Key Additions:  
1. **Repository Structure Section**:  
   - Clear breakdown of directories and their purposes.  
   - Highlights Ansible roles and Terraform files.  
2. **Precise Path References**:  
   - Added context for `local-exec` paths (e.g., `../ansible/site.yml`).  
3. **Simplified Setup**:  
   - Combined clone + deploy steps into a streamlined flow.  

Let me know if you'd like to emphasize any other aspects!
